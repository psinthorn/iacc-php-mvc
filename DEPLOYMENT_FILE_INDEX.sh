#!/bin/bash
# Quick reference for all deployment files
# Run this script to see complete file structure

echo "======================================"
echo "iAcc Deployment Package - File Index"
echo "======================================"
echo ""
echo "ðŸ“‹ MASTER DOCUMENTATION"
echo "â”œâ”€ DEPLOYMENT_README.md"
echo "â”‚  â””â”€ START HERE: Overview of entire deployment process"
echo "â”‚  â””â”€ Quick start guide"
echo "â”‚  â””â”€ Success indicators"
echo "â”‚  â””â”€ Emergency procedures"
echo ""
echo "â”œâ”€ DEPLOYMENT_PLAN_STEPS_1-4.md"
echo "â”‚  â””â”€ Complete execution plan for all 4 steps"
echo "â”‚  â””â”€ Timeline and schedule"
echo "â”‚  â””â”€ Risk mitigation strategies"
echo "â”‚  â””â”€ Sign-off checklist"
echo ""
echo "ðŸ“‚ docs/"
echo "â”œâ”€ STAGING_DEPLOYMENT_GUIDE.md"
echo "â”‚  â””â”€ Step 3: Create staging environment"
echo "â”‚  â””â”€ Subdomain setup (iacc-staging.f2.co.th)"
echo "â”‚  â””â”€ Database cloning"
echo "â”‚  â””â”€ Configuration isolation"
echo "â”‚  â””â”€ Testing procedures"
echo "â”‚  â””â”€ Environment variables"
echo ""
echo "â”œâ”€ UPGRADE_PHP_MYSQL.md"
echo "â”‚  â””â”€ Step 2: Upgrade to PHP 8.3 & MySQL 8.0"
echo "â”‚  â””â”€ Pre-upgrade backup procedures"
echo "â”‚  â””â”€ EasyApache upgrade steps"
echo "â”‚  â””â”€ MySQL upgrade steps"
echo "â”‚  â””â”€ Post-upgrade verification"
echo "â”‚  â””â”€ Rollback procedures"
echo "â”‚  â””â”€ Monitoring guide"
echo ""
echo "â”œâ”€ TESTING_CHECKLIST.md"
echo "â”‚  â””â”€ Step 4: Comprehensive testing"
echo "â”‚  â””â”€ 86 test items across 13 sections"
echo "â”‚  â”œâ”€ System infrastructure (4 tests)"
echo "â”‚  â”œâ”€ Authentication (6 tests)"
echo "â”‚  â”œâ”€ Core modules (30 tests)"
echo "â”‚  â”œâ”€ PDF generation with logos (15 tests) âš ï¸ CRITICAL"
echo "â”‚  â”œâ”€ File operations (9 tests)"
echo "â”‚  â”œâ”€ Database operations (9 tests)"
echo "â”‚  â”œâ”€ Performance (4 tests)"
echo "â”‚  â”œâ”€ Security (12 tests)"
echo "â”‚  â”œâ”€ Error handling (8 tests)"
echo "â”‚  â”œâ”€ PHP 8.3 compatibility (6 tests)"
echo "â”‚  â”œâ”€ MySQL 8.0 compatibility (6 tests)"
echo "â”‚  â”œâ”€ Deployment verification (5 tests)"
echo "â”‚  â””â”€ Sign-off (5 tests)"
echo ""
echo "ðŸ“‚ backup/"
echo "â”œâ”€ backup.sh"
echo "â”‚  â””â”€ Automated backup script"
echo "â”‚  â””â”€ Creates: database_*.sql.gz, upload_*.tar.gz, app_*.tar.gz"
echo "â”‚  â””â”€ Retention: Last 10 backups"
echo "â”‚  â””â”€ Logging: Detailed log files"
echo ""
echo "â””â”€ restore.sh"
echo "   â””â”€ Database restoration script"
echo "   â””â”€ Restore from specific backup date"
echo "   â””â”€ Confirmation prompts"
echo ""
echo "ðŸ“‚ scripts/"
echo "â”œâ”€ deploy-production.sh"
echo "â”‚  â””â”€ Automated production deployment"
echo "â”‚  â””â”€ Pre-deployment backups"
echo "â”‚  â””â”€ Git pull from main branch"
echo "â”‚  â””â”€ Permission fixing"
echo "â”‚  â””â”€ Service restart"
echo "â”‚  â””â”€ Health check"
echo "â”‚  â””â”€ Detailed logging"
echo ""
echo "â””â”€ rollback.sh"
echo "   â””â”€ Emergency rollback script"
echo "   â””â”€ Restore database from backup"
echo "   â””â”€ Restore files from backup"
echo "   â””â”€ Service restart"
echo "   â””â”€ Verification"
echo ""
echo "ðŸ“‚ iacc/inc/"
echo "â””â”€ env-detect.php"
echo "   â””â”€ Environment detection system"
echo "   â””â”€ Auto-detects: staging vs production vs local"
echo "   â””â”€ Loads environment-specific config"
echo "   â””â”€ Database: iacc_database vs iacc_staging"
echo "   â””â”€ Debug mode: ON for staging, OFF for production"
echo "   â””â”€ Labels: RED (prod), ORANGE (staging), BLUE (local)"
echo ""
echo "======================================"
echo "DEPLOYMENT EXECUTION ORDER"
echo "======================================"
echo ""
echo "1ï¸âƒ£  PRE-DEPLOYMENT (30 min)"
echo "   â”œâ”€ Read: DEPLOYMENT_README.md"
echo "   â”œâ”€ Read: DEPLOYMENT_PLAN_STEPS_1-4.md"
echo "   â””â”€ Execute: backup/backup.sh"
echo ""
echo "2ï¸âƒ£  UPGRADE INFRASTRUCTURE (2-3 hours)"
echo "   â”œâ”€ Follow: docs/UPGRADE_PHP_MYSQL.md"
echo "   â”œâ”€ Upgrade PHP to 8.3 (45 min)"
echo "   â”œâ”€ Upgrade MySQL to 8.0 (45 min)"
echo "   â””â”€ Verify: All systems working (20 min)"
echo ""
echo "3ï¸âƒ£  SETUP STAGING (1-2 hours)"
echo "   â”œâ”€ Follow: docs/STAGING_DEPLOYMENT_GUIDE.md"
echo "   â”œâ”€ Create: iacc-staging.f2.co.th subdomain"
echo "   â”œâ”€ Clone: Production database to iacc_staging"
echo "   â”œâ”€ Deploy: Application code to staging"
echo "   â””â”€ Verify: Environment detection working"
echo ""
echo "4ï¸âƒ£  TEST ON STAGING (1-2 hours)"
echo "   â”œâ”€ Access: https://iacc-staging.f2.co.th"
echo "   â”œâ”€ Run: docs/TESTING_CHECKLIST.md (86 tests)"
echo "   â”œâ”€ Critical: PDF logo display tests âœ“"
echo "   â”œâ”€ Verify: No errors in logs"
echo "   â””â”€ Sign-off: Testing complete"
echo ""
echo "5ï¸âƒ£  DEPLOY TO PRODUCTION (1 hour)"
echo "   â”œâ”€ Execute: scripts/deploy-production.sh"
echo "   â”œâ”€ Or Manual:"
echo "   â”‚  â”œâ”€ cd /public_html/iacc"
echo "   â”‚  â”œâ”€ git pull origin main"
echo "   â”‚  â”œâ”€ chmod -R 755 ."
echo "   â”‚  â”œâ”€ chmod -R 777 upload/"
echo "   â”‚  â””â”€ systemctl restart php-fpm"
echo "   â””â”€ Verify: https://iacc.f2.co.th"
echo ""
echo "6ï¸âƒ£  MONITOR POST-DEPLOYMENT (24 hours)"
echo "   â”œâ”€ Check: Error logs"
echo "   â”œâ”€ Monitor: Database performance"
echo "   â”œâ”€ Test: All critical functions"
echo "   â””â”€ Confirm: All systems stable"
echo ""
echo "======================================"
echo "CRITICAL FILES & TESTING"
echo "======================================"
echo ""
echo "âš ï¸  MUST TEST (PDF Generation with Logos)"
echo "   â”œâ”€ Tax Invoice PDF with logo âœ“"
echo "   â”œâ”€ Invoice PDF with logo âœ“"
echo "   â”œâ”€ Delivery Note PDF with logo âœ“"
echo "   â”œâ”€ Voucher PDF with logo âœ“"
echo "   â”œâ”€ Report PDFs with logos âœ“"
echo "   â””â”€ Location: docs/TESTING_CHECKLIST.md (15 tests)"
echo ""
echo "âš ï¸  MUST VERIFY (PHP 8.3 Compatibility)"
echo "   â”œâ”€ No deprecated each() function"
echo "   â”œâ”€ No deprecated array syntax {}"
echo "   â”œâ”€ No mysql_* functions (except wrappers)"
echo "   â””â”€ Location: docs/TESTING_CHECKLIST.md (6 tests)"
echo ""
echo "âš ï¸  MUST VERIFY (MySQL 8.0 Compatibility)"
echo "   â”œâ”€ Connection successful"
echo "   â”œâ”€ All queries work"
echo "   â”œâ”€ Character encoding: utf8mb4"
echo "   â””â”€ Location: docs/TESTING_CHECKLIST.md (6 tests)"
echo ""
echo "======================================"
echo "EMERGENCY PROCEDURES"
echo "======================================"
echo ""
echo "ðŸš¨ IF SOMETHING GOES WRONG:"
echo "   â”œâ”€ Check error logs:"
echo "   â”‚  â””â”€ tail -f /public_html/iacc/error_log"
echo "   â”‚  â””â”€ tail -f /var/log/mysql/error.log"
echo "   â”‚  â””â”€ tail -f /var/log/iacc-deploy.log"
echo ""
echo "ðŸš¨ QUICK ROLLBACK:"
echo "   â””â”€ cd /public_html/iacc"
echo "   â””â”€ ./scripts/rollback.sh [backup_date]"
echo ""
echo "ðŸš¨ RESTORE DATABASE ONLY:"
echo "   â””â”€ cd /backups"
echo "   â””â”€ ./restore.sh database_YYYYMMDD_HHMMSS.sql.gz"
echo ""
echo "======================================"
echo "FILE SUMMARY"
echo "======================================"
echo ""
ls -lh /Volumes/Data/Projects/iAcc-PHP-MVC/ | grep -E "^d|DEPLOYMENT|README"
echo ""
ls -lh /Volumes/Data/Projects/iAcc-PHP-MVC/docs/ 2>/dev/null | grep "\.md"
echo ""
ls -lh /Volumes/Data/Projects/iAcc-PHP-MVC/scripts/ 2>/dev/null | grep "\.sh"
echo ""
ls -lh /Volumes/Data/Projects/iAcc-PHP-MVC/backup/ 2>/dev/null | grep "\.sh"
echo ""
echo "======================================"
echo "âœ… DEPLOYMENT PACKAGE COMPLETE"
echo "======================================"
echo ""
echo "Status: READY FOR PRODUCTION DEPLOYMENT"
echo ""
echo "Next Step: Read DEPLOYMENT_README.md"
echo ""
